# Build configuration for Cin7 DSL documentation site with integrated Storybook
# DRAMATIC BUNDLE HASH CHANGE: 2025-11-10T09:15:00Z - Force new compilation
[build]
  base = "polaris/polaris.shopify.com"
  publish = ".next"
  command = "bash ../../scripts/netlify-build.sh"
  # Always build (disable smart build detection to include storybook changes)
  ignore = "exit 1"  # Return non-zero to never skip builds

[build.environment]
  NODE_VERSION = "20.10.0"
  NEXT_TELEMETRY_DISABLED = "1"
  # NUCLEAR cache invalidation - disable ALL caching
  NPM_CONFIG_CACHE = "/dev/null"
  NETLIFY_BUILD_CACHE = "false"
  NEXT_FORCE_NO_CACHE = "true"
  YARN_CACHE_FOLDER = "/dev/null"
  # Force bundle regeneration
  CACHE_BUST = "NUCLEAR-1762719448823-hpfeo"
  FORCE_REBUILD = "true"

[[plugins]]
  package = "@netlify/plugin-nextjs"

# Deny iframe embedding for all pages by default
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    X-XSS-Protection = "1; mode=block"
    X-Robots-Tag = "noai, noimageai"

# NUCLEAR CDN cache invalidation for all JavaScript bundles
[[headers]]
  for = "*.js"
  [headers.values]
    Cache-Control = "no-cache, no-store, must-revalidate, max-age=0"
    Pragma = "no-cache"
    Expires = "0"
    X-Cache-Bust = "NUCLEAR-1762719448823-hpfeo"

# Allow Storybook to use iframes (for component previews)
# This must come AFTER /* to override the DENY setting
[[headers]]
  for = "/storybook/*"
  [headers.values]
    X-Frame-Options = "SAMEORIGIN"
    X-Content-Type-Options = "nosniff"
    X-XSS-Protection = "1; mode=block"
    X-Robots-Tag = "noai, noimageai"
    Cache-Control = "no-cache, no-store, must-revalidate, max-age=0"
    X-Cache-Bust = "NUCLEAR-1762719448823-hpfeo"
